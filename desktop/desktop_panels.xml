<?xml version="1.0" encoding="iso-8859-1"?>

<!-- Please see the LICENSE.md file included with this distribution for attribution and copyright information. -->

<root version="3.0">
	<panel name="date" modes="host">
		<class>chattime</class>
		<bounds>10,100,260,110</bounds>
		<dynamic />
		<locked />
	</panel>

	<windowclass name="chattime">
		<frame>recordsheet</frame>
		<size width="260" height="110" />
		<noclose />
		<sheetdata>
			<label name="currenthour">
				<anchored position="insidetopleft" width="20">
					<left anchor="left" offset="15" />
					<top offset="22" />
				</anchored>
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<readonly />
				<center />
				<!-- Opening timedevents, timedreminders, and travelmanager in onInit() allows for their
				triggers to work correctly on campaign open, otherwise they don't work until opened manually. -->
				<script>
					function onInit()
						if not DB.getValue(TimeManager.CAL_NEWCAMPAIGN, 0) == 1 then
							local nYear = DB.getValue(TimeManager.CAL_CUR_YEAR);
							if not nYear then
								DB.setValue(TimeManager.CAL_CUR_YEAR, "number", 0);
							end
							local nMonth = DB.getValue(TimeManager.CAL_CUR_MONTH);
							if not nMonth or nMonth == 0 then
								DB.setValue(TimeManager.CAL_CUR_MONTH, "number", 1);
							end
							local nDay = DB.getValue(TimeManager.CAL_CUR_DAY);
							if not nDay then
								DB.setValue(TimeManager.CAL_CUR_DAY, "number", 1);
							end
							local nMinute = DB.getValue(TimeManager.CAL_CUR_MIN);
							if not nMinute then
								DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
							end
							local nHour = DB.getValue(TimeManager.CAL_CUR_HOUR);
							if not nHour then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 0);
							end
							Interface.openWindow("calendar", "DB");
							DB.setValue(TimeManager.CAL_NEWCAMPAIGN, "number", 1);
						end
						DB.addHandler(TimeManager.CAL_CUR_HOUR, "onUpdate", onSourceChanged);
						onSourceChanged();

						Interface.openWindow("timedevents", "DB");
						Interface.toggleWindow("timedevents", "DB");
						Interface.openWindow("timedreminders", "DB");
						Interface.toggleWindow("timedreminders", "DB");
						Interface.openWindow("travelmanager", "DB");
						Interface.toggleWindow("travelmanager", "DB");
					end

					function onClose()
						DB.removeHandler(TimeManager.CAL_CUR_HOUR, "onUpdate", onSourceChanged);
					end

					function onSourceChanged()
						local nHour, sPhase = CalendarManager.getDisplayHour();
						setValue(string.format("%2d", nHour));
						window.currentphase.setValue(sPhase);
					end
				</script>
			</label>
			<label name="timesep">
				<anchored to="currenthour" position="righthigh" offset="5" />
				<static>:</static>
			</label>
			<label name="currentminute">
				<anchored to="timesep" position="righthigh" offset="6" width="20" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<readonly />
				<center />
				<timeunit>calendar.current.minute</timeunit>
				<script file="desktop/scripts/current_mdmy.lua" />
			</label>
			<label name="currentphase">
				<anchored to="currentminute" position="righthigh" offset="10" width="20" />
				<center />
			</label>
			<label name="currentday">
				<anchored to="currentphase" position="righthigh" offset="10" width="20" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<readonly />
				<center />
				<timeunit>calendar.current.day</timeunit>
				<script file="desktop/scripts/current_mdmy.lua" />
			</label>
			<label name="currentmonth">
				<anchored to="currentday" position="righthigh" offset="15" width="20" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<readonly />
				<center />
				<timeunit>calendar.current.month</timeunit>
				<script file="desktop/scripts/current_mdmy.lua" />
			</label>
			<label name="currentyear">
				<anchored to="currentmonth" position="righthigh" offset="10" width="50" />
				<frame name="fieldlight" offset="7,5,7,5" />
				<stateframe>
					<hover name="fieldfocus" offset="7,5,7,5" />
				</stateframe>
				<readonly />
				<center />
				<timeunit>calendar.current.year</timeunit>
				<script file="desktop/scripts/current_mdmy.lua" />
			</label>

			<basicnumber name="addhour" source="addhour">
				<anchored to="currenthour" width="20">
					<left anchor="left" offset="0" />
					<top anchor="bottom" offset="10" />
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_addhour_tooltip" />
				<script>
					function onInit()
						setValue(DB.getValue("calendar.addhour", 0));
					end
					function onClose()
						DB.setValue("calendar.addhour", "number", getValue() or 0);
					end
					function onDoubleClick()
						local nHour = getValue() or 0;
						local nRounds = nHour * 600;

						if OptionsManager.isOption('TIMEROUNDS', 'slow') and nRounds &lt; 4801 then
							CombatManager.nextRound(nRounds, true);
						else
							LongTermEffects.advanceRoundsOnTimeChanged(nRounds)
						end
						CalendarManager.adjustHours(nHour);
						
						TimeManager.checkWeather();
						if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
							CalendarManager.outputDate();
							DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
						end
						if nHour &gt; 0 then
							CalendarManager.outputTime();
						end
						onUpdate();
					end
					local bTimeStep = false;
					function onUpdate()
						bTimeStep = true;


						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);

						DB.setValue("calendar.addhour", "number", getValue() or 0);
						TimeManager.TimeChanged();
					end
				</script>
			</basicnumber>
			<label name="timesep2">
				<anchored to="addhour" position="righthigh" offset="5" />
				<static>:</static>
			</label>
			<basicnumber name="addminute" source="addminute">
				<anchored to="timesep2" position="righthigh" offset="6" width="20" />
				<min>0</min>
				<tooltip textres="desktop_addminute_tooltip" />
				<script>
					function onInit()
						setValue(DB.getValue("calendar.addminute", 0));
					end
					function onClose()
						DB.setValue("calendar.addminute", "number", getValue() or 0);
					end
					function onDoubleClick()
						local nMinute = getValue() or 0;
						local nRounds = nMinute * 10;

						if OptionsManager.isOption('TIMEROUNDS', 'slow') and nRounds &lt; 4801 then
							CombatManager.nextRound(nRounds, true);
						else
							LongTermEffects.advanceRoundsOnTimeChanged(nRounds)
						end
						CalendarManager.adjustMinutes(nMinute);
						if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
							CalendarManager.outputDate();
							DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
						end
						if nMinute &gt; 0 then
							CalendarManager.outputTime();
						end
						onUpdate();
					end
					local bTimeStep = false;
					function onUpdate()
						bTimeStep = true;

						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);

						DB.setValue("calendar.addminute", "number", getValue() or 0);
						TimeManager.TimeChanged();
					end
				</script>
			</basicnumber>

			<basicnumber name="addday" source="addday">
				<anchored to="currentday" width="20">
					<left anchor="left" offset="0" />
					<top anchor="bottom" offset="10" />
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_addday_tooltip" />
				<script>
					function onInit()
						setValue(DB.getValue("calendar.addday", 0));
					end
					function onClose()
						DB.setValue("calendar.addday", "number", getValue() or 0);
					end

					function onDoubleClick()
						local nDay = getValue() or 0;
						local nRounds = nDay * 14400;

						if OptionsManager.isOption('TIMEROUNDS', 'slow') and nRounds &lt; 4801 then
							CombatManager.nextRound(nRounds, true);
						else
							LongTermEffects.advanceRoundsOnTimeChanged(nRounds)
						end
						CalendarManager.adjustDays(nDay);
						
						TimeManager.checkWeather();
						if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
							DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
						end
						if nDay &gt; 0 then
							CalendarManager.outputDate();
						end
						onUpdate();
					end
					local bTimeStep = false;
					function onUpdate()
						bTimeStep = true;


						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);

						DB.setValue("calendar.addday", "number", getValue() or 0);
						TimeManager.TimeChanged();
					end
				</script>
			</basicnumber>
			<basicnumber name="addmonth" source="addmonth">
				<anchored to="addday" position="righthigh" offset="15" width="20" />
				<min>0</min>
				<tooltip textres="desktop_addmonth_tooltip" />
				<script>
					function onInit()
						setValue(DB.getValue("calendar.addmonth", 0));
					end
					function onClose()
						DB.setValue("calendar.addmonth", "number", getValue() or 0);
					end
					function onDoubleClick()
						local nMonth = getValue() or 0;
						local nRounds = nMonth * 432000;

						if OptionsManager.isOption('TIMEROUNDS', 'slow') and nRounds &lt; 4801 then
							CombatManager.nextRound(nRounds, true);
						else
							LongTermEffects.advanceRoundsOnTimeChanged(nRounds)
						end

						CalendarManager.adjustMonths(nMonth);
						
						TimeManager.checkWeather();
						if nMonth &gt; 0 then
							CalendarManager.outputDate();
						end
						onUpdate();
					end
					local bTimeStep = false;
					function onUpdate()
						bTimeStep = true;


						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);

						DB.setValue("calendar.addmonth", "number", getValue() or 0);
						TimeManager.TimeChanged();
					end
				</script>
			</basicnumber>
			<basicnumber name="addyear" source="addyear">
				<anchored to="addmonth" position="righthigh" offset="10" width="50" />
				<min>0</min>
				<tooltip textres="desktop_addyears_tooltip" />
				<script>
					function onInit()
						setValue(DB.getValue("calendar.addyear", 0));
					end
					function onClose()
						DB.setValue("calendar.addyear", "number", getValue() or 0);
					end
					function onDoubleClick()
						local nYear = (window.addyear.getValue() or 0);

						CalendarManager.adjustYears(nYear);
						
						TimeManager.checkWeather();
						if nYear &gt; 0 then
							CalendarManager.outputDate();
						end
						onUpdate();
					end
					local bTimeStep = false;
					function onUpdate()
						bTimeStep = true;


						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);

						DB.setValue("calendar.addyear", "number", getValue() or 0);
						
						TimeManager.TimeChanged();
					end
				</script>
			</basicnumber>

			<label name="addall">
				<anchored to="addminute" position="righthigh" offset="9" width="24" />
				<static textres="desktop_panel_add" />
				<tooltip textres="desktop_addall_tooltip" />
				<script>
					function onDoubleClick()
						local nMinute = window.addminute.getValue() or 0;
						local nHour = window.addhour.getValue() or 0;
						local nDay = window.addday.getValue() or 0;
						local nMonth = window.addmonth.getValue() or 0;
						local nYear = window.addyear.getValue() or 0;
						local nRounds = (nHour * 600) + (nMinute * 10) + (nDay * 14400) + (nMonth * 403200);

						if OptionsManager.isOption('TIMEROUNDS', 'slow') and nRounds &lt; 4801 then
							CombatManager.nextRound(nRounds, true);
						else
							LongTermEffects.advanceRoundsOnTimeChanged(nRounds)
						end
						TimeManager.checkWeather()
						CalendarManager.adjustMinutes(nMinute);
						CalendarManager.adjustHours(nHour);
						CalendarManager.adjustDays(nDay);
						CalendarManager.adjustMonths(nMonth);
						CalendarManager.adjustYears(nYear);
						CalendarManager.outputDate();
						CalendarManager.outputTime();
						onUpdate();
					end
					local bTimeStep = false;
					function onUpdate()
						bTimeStep = true;


						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);
						
						TimeManager.TimeChanged();
					end
				</script>
				<center />
			</label>

			<basicnumber name="longrest">
				<anchored to="addhour" width="20">
					<left anchor="left" offset="0" />
					<top anchor="bottom" offset="10" />
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_longrest" />
				<script>
					local bIsbLong, bIsbShort
					function onInit()
						local sRuleset = User.getRulesetName();
						bIsbLong = (sRuleset == "4E" or sRuleset == "5E")
						bIsbShort = (sRuleset == "PFRPG" or sRuleset == "PFRPG2" or sRuleset == "3.5E")
						if not bIsbLong and not bIsbShort then
							setVisible(false);
						else
							setValue(DB.getValue(DB.findNode('calendar'), 'lastlongrest', 0))
 						end
					end
					function onDoubleClick()
						CalendarManager.adjustHours((getValue() or 0));

						if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
							CalendarManager.outputDate();
							DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
						end
						

						local nHours = getValue() or 0;
						local nRounds = nHours * 600;

						if OptionsManager.isOption('TIMEROUNDS', 'slow') and nRounds &lt; 4801 then
							CombatManager.nextRound(nRounds, true);
						else
							LongTermEffects.advanceRoundsOnTimeChanged(nRounds);
						end

						DB.setValue(DB.findNode('calendar'), 'lastlongrest', 'number', nHours)

						CalendarManager.outputTime();
						ChatManager.Message(Interface.getString("ct_message_restlong") or Interface.getString("ct_message_restovernight") or Interface.getString("ct_message_restextended") or "Long Rest", true);

						if bIsbLong then
							CombatManager2.rest(true);
						elseif bIsbShort then
							CombatManager2.rest();
						end
						TimeManager.checkWeather();

						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);
						
						TimeManager.TimeChanged();
					end
				</script>
			</basicnumber>

			<basicnumber name="shortrest">
				<anchored to="addminute" width="20">
					<left anchor="left" offset="0" />
					<top anchor="bottom" offset="10" />
				</anchored>
				<min>0</min>
				<tooltip textres="desktop_shortrest" />
				<script>
					local bIsbLong, bIsbShort
					function onInit()
						local sRuleset = User.getRulesetName();
						bIsbLong = (sRuleset == "4E" or sRuleset == "5E")
						bIsbShort = (sRuleset == "PFRPG" or sRuleset == "PFRPG2" or sRuleset == "3.5E")
						if not bIsbLong and not bIsbShort then
							setVisible(false);
						else
							setValue(DB.getValue(DB.findNode('calendar'), 'lastshortrest', 0))
 						end
					end
					function onDoubleClick()
						CalendarManager.adjustMinutes((getValue() or 0));

						if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
							CalendarManager.outputDate();
							DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
						end

						local nMinutes = getValue() or 0
						local nRounds = nMinutes * 10;

						if OptionsManager.isOption('TIMEROUNDS', 'slow') and nRounds &lt; 4801 then
							CombatManager.nextRound(nRounds, true);
						else
							LongTermEffects.advanceRoundsOnTimeChanged(nRounds)
						end

						DB.setValue(DB.findNode('calendar'), 'lastshortrest', 'number', nMinutes)

						CalendarManager.outputTime();
						ChatManager.Message(Interface.getString("ct_message_rest") or Interface.getString("menu_restshort"), true);

						if bIsbLong then
							CombatManager2.rest();
						elseif bIsbShort then
							CombatManager2.rest(true);
						end

						local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
						nCurrentRound = nCurrentRound % 10
						DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);
						TimeManager.TimeChanged();
					end
				</script>
			</basicnumber>

			<buttoncontrol name="adv6am">
				<anchored to="shortrest" position="righthigh" offset="10,0" width="20" height="20" />
				<icon normal="6AM_Dark" pressed="6AM_Dark_down" />
				<tooltip textres="desktop_adv6am_tooltip" />
				<script>
					function onButtonPress()
						local nCurrentHour = DB.getValue(TimeManager.CAL_CUR_HOUR, 0);
						local nCurrentMinute = DB.getValue(TimeManager.CAL_CUR_MIN, 0);

						if TimeManager.getCurrentDate() then
							if nCurrentHour &gt;= 6 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 6);
								CalendarManager.adjustDays(1);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							elseif nCurrentHour &lt; 6 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 6);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							end
							
							TimeManager.checkWeather();
							if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
								CalendarManager.outputDate();
								DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
							end
							CalendarManager.outputTime();

							local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
							nCurrentRound = nCurrentRound % 10
							DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);
							TimeManager.TimeChanged();
						end
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv12pm">
				<anchored to="adv6am" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="12PM_Dark" pressed="12PM_Dark_down" />
				<tooltip textres="desktop_adv12pm_tooltip" />
				<script>
					function onButtonPress()
						local nCurrentHour = DB.getValue(TimeManager.CAL_CUR_HOUR, 0);
						local nCurrentMinute = DB.getValue(TimeManager.CAL_CUR_MIN, 0);

						if TimeManager.getCurrentDate() then
							if nCurrentHour &gt;= 12 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 12);
								CalendarManager.adjustDays(1);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							elseif nCurrentHour &lt; 12 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 12);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							end
							
							TimeManager.checkWeather();
							if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
								CalendarManager.outputDate();
								DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
							end
							CalendarManager.outputTime();


							local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
							nCurrentRound = nCurrentRound % 10
							DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);
							TimeManager.TimeChanged();
						end
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv6pm">
				<anchored to="adv12pm" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="6PM_Dark" pressed="6PM_Dark_down" />
				<tooltip textres="desktop_adv6pm_tooltip" />
				<script>
					function onButtonPress()
						local nCurrentHour = DB.getValue(TimeManager.CAL_CUR_HOUR, 0);
						local nCurrentMinute = DB.getValue(TimeManager.CAL_CUR_MIN, 0);

						if TimeManager.getCurrentDate() then
							if nCurrentHour &gt;= 18 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 18);
								CalendarManager.adjustDays(1);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							elseif nCurrentHour &lt; 18 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 18);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							end
							
							TimeManager.checkWeather();
							if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
								CalendarManager.outputDate();
								DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
							end
							CalendarManager.outputTime();


							local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
							nCurrentRound = nCurrentRound % 10
							DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);
							TimeManager.TimeChanged();
							
						end
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="adv12am">
				<anchored to="adv6pm" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="12AM_Dark" pressed="12AM_Dark_down" />
				<tooltip textres="desktop_adv12am_tooltip" />
				<script>
					function onButtonPress()
						local nCurrentHour = DB.getValue(TimeManager.CAL_CUR_HOUR, 0);
						local nCurrentMinute = DB.getValue(TimeManager.CAL_CUR_MIN, 0);

						if TimeManager.getCurrentDate() then
							if nCurrentHour &gt;= 0 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 0);
								CalendarManager.adjustDays(1);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							elseif nCurrentHour &lt; 0 then
								DB.setValue(TimeManager.CAL_CUR_HOUR, "number", 0);
								if nCurrentMinute &gt;= 1 then
									DB.setValue(TimeManager.CAL_CUR_MIN, "number", 0);
								end
							end

							
							TimeManager.checkWeather();
							if DB.getValue(TimeManager.CAL_CHK_DAY) == nil or DB.getValue(TimeManager.CAL_CHK_DAY) ~= DB.getValue(TimeManager.CAL_CUR_DAY) then
								CalendarManager.outputDate();
								DB.setValue(TimeManager.CAL_CHK_DAY, "number", DB.getValue(TimeManager.CAL_CUR_DAY));
							end
							CalendarManager.outputTime();


							local nCurrentRound = DB.getValue(CombatManager.CT_ROUND, 0);
							nCurrentRound = nCurrentRound % 10
							DB.setValue(CombatManager.CT_ROUND, 'number', nCurrentRound);
							TimeManager.TimeChanged();
						end
					end
				</script>
			</buttoncontrol>
			<buttoncontrol name="openevents">
				<anchored to="adv12am" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="add_logentry" pressed="add_logentry_down" />
				<tooltip textres="desktop_openevents_tooltip" />
				<subwindow>timedevents</subwindow>
				<script file="desktop/scripts/open_subwindow.lua" />
			</buttoncontrol>
			<buttoncontrol name="openreminders">
				<anchored to="openevents" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="reminder_button" pressed="reminder_button_down" />
				<tooltip textres="desktop_openreminders_tooltip" />
				<subwindow>timedreminders</subwindow>
				<script file="desktop/scripts/open_subwindow.lua" />
			</buttoncontrol>
			<buttoncontrol name="opentravelmanager">
				<anchored to="openreminders" position="righthigh" offset="2,0" width="20" height="20" />
				<icon normal="atob_button" pressed="atob_button_down" />
				<tooltip textres="desktop_opentravel_tooltip" />
				<subwindow>travelmanager</subwindow>
				<script file="desktop/scripts/open_subwindow.lua" />
			</buttoncontrol>
			<button_checkbox name="checkweather" source=".checkweather">
				<anchored to="opentravelmanager" position="righthigh" offset="0,0" width="20" height="20" />
				<values>
					<maximum>1</maximum>
				</values>
				<tooltip text="Check Weather on Time Adjust; NOTE: You must have a table for each 'Weather Wind', 'Weather Temperature', and 'Weather Precipitation'" />
				<script>
					function onInit()
						if super and super.onInit() then
							super.onInit();
						end
					end
					function onValueChanged()
						if super and super.onValueChanged() then
							super.onValueChanged();
						end
						DB.setValue(DB.createNode("DB.checkweather" ,"number"), "", "number", getValue());
					end
				</script>	
			</button_checkbox>
		</sheetdata>
	</windowclass>

	
</root>
